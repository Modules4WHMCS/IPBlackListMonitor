!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","./grid.base"],e):"object"==typeof module&&module.exports?module.exports=function(r,t){return r||(r=window),void 0===t&&(t="undefined"!=typeof window?require("jquery"):require("jquery")(r)),require("./grid.base"),e(t),t}:e(jQuery)}(function(e){"use strict";var r=e.jgrid,t=r.getAccessor,a=r.stripPref,i=r.jqID,d=e.fn.jqGrid,l=function(){var t=e.makeArray(arguments);return t[0]="treeGrid"+t[0].charAt(0).toUpperCase()+t[0].substring(1),t.unshift(""),t.unshift(""),t.unshift(this.p),r.feedback.apply(this,t)};r.extend({setTreeNode:function(){return this.each(function(){var r=this,t=e(r),i=r.p;if(r.grid&&i.treeGrid){var l=i.treeReader.expanded_field,n=i.treeReader.leaf_field,o=function(r,o,s){if(null!=s){var c=e(s.target),f=c.closest("tr.jqgrow>td"),p=f.parent(),u=function(){var e=i.data[i._index[a(i.idPrefix,o)]],r=e[l]?"collapse":"expand";e[n]||(d[r+"Row"].call(t,e,p),d[r+"Node"].call(t,e,p))};return c.is("div.treeclick")?u():i.ExpandColClick&&f.length>0&&c.closest("span.cell-wrapper",f).length>0&&u(),!0}};t.off("jqGridBeforeSelectRow.setTreeNode"),t.on("jqGridBeforeSelectRow.setTreeNode",o)}})},setTreeGrid:function(){return this.each(function(){var r,t,a,i=this,d=i.p,l=[],n=["leaf_field","expanded_field","loaded"];if(d.treeGrid){d.treedatatype||e.extend(i.p,{treedatatype:d.datatype}),d.subGrid=!1,d.altRows=!1,d.pgbuttons=!1,d.pginput=!1,d.gridview=!0,null===d.rowTotal&&(d.rowNum=d.maxRowNum),d.rowList=[],d.treeIcons.plus="rtl"===d.direction?d.treeIcons.plusRtl:d.treeIcons.plusLtr,"nested"===d.treeGridModel?d.treeReader=e.extend({level_field:"level",left_field:"lft",right_field:"rgt",leaf_field:"isLeaf",expanded_field:"expanded",loaded:"loaded",icon_field:"icon"},d.treeReader):"adjacency"===d.treeGridModel&&(d.treeReader=e.extend({level_field:"level",parent_id_field:"parent",leaf_field:"isLeaf",expanded_field:"expanded",loaded:"loaded",icon_field:"icon"},d.treeReader));for(t in d.colModel)if(d.colModel.hasOwnProperty(t)){r=d.colModel[t].name;for(a in d.treeReader)d.treeReader.hasOwnProperty(a)&&d.treeReader[a]===r&&l.push(r)}e.each(d.treeReader,function(r){var t=String(this);t&&-1===e.inArray(t,l)&&(e.inArray(r,n)>=0?d.additionalProperties.push({name:t,search:!1,convert:function(e){return!0===e||"true"===String(e).toLowerCase()||"1"===String(e)||e}}):d.additionalProperties.push(t))})}})},expandRow:function(r){this.each(function(){var a=this,i=e(a),n=a.p;if(a.grid&&n.treeGrid){var o=n.treeReader.expanded_field,s=r[n.localReader.id];if(l.call(a,"beforeExpandRow",{rowid:s,item:r})){var c=d.getNodeChildren.call(i,r);e(c).each(function(){var r=n.idPrefix+t(this,n.localReader.id);e(d.getGridRowById.call(i,r)).css("display",""),this[o]&&d.expandRow.call(i,this)}),l.call(a,"afterExpandRow",{rowid:s,item:r})}}})},collapseRow:function(r){this.each(function(){var a=this,i=e(a),n=a.p;if(a.grid&&n.treeGrid){var o=n.treeReader.expanded_field,s=r[n.localReader.id];if(l.call(a,"beforeCollapseRow",{rowid:s,item:r})){var c=d.getNodeChildren.call(i,r);e(c).each(function(){var r=n.idPrefix+t(this,n.localReader.id);e(d.getGridRowById.call(i,r)).css("display","none"),this[o]&&d.collapseRow.call(i,this)}),l.call(a,"afterCollapseRow",{rowid:s,item:r})}}})},getRootNodes:function(){var r=[];return this.each(function(){var t=this,a=t.p;if(t.grid&&a.treeGrid)switch(a.treeGridModel){case"nested":var i=a.treeReader.level_field;e(a.data).each(function(){parseInt(this[i],10)===parseInt(a.tree_root_level,10)&&r.push(this)});break;case"adjacency":var d=a.treeReader.parent_id_field;e(a.data).each(function(){null!==this[d]&&"null"!==String(this[d]).toLowerCase()||r.push(this)})}}),r},getNodeDepth:function(r){var t=null;return this.each(function(){var a=this,i=a.p;if(a.grid&&i.treeGrid)switch(i.treeGridModel){case"nested":var l=i.treeReader.level_field;t=parseInt(r[l],10)-parseInt(i.tree_root_level,10);break;case"adjacency":t=d.getNodeAncestors.call(e(a),r).length}}),t},getNodeParent:function(r){var t=this[0];if(!t||!t.grid||null==t.p||!t.p.treeGrid||null==r)return null;var a=t.p,i=a.treeReader,d=r[i.parent_id_field];if("nested"===a.treeGridModel){var l=null,n=i.left_field,o=i.right_field,s=i.level_field,c=parseInt(r[n],10),f=parseInt(r[o],10),p=parseInt(r[s],10);return e(a.data).each(function(){if(parseInt(this[s],10)===p-1&&parseInt(this[n],10)<c&&parseInt(this[o],10)>f)return l=this,!1}),l}if(null===d||"null"===d)return null;var u=a._index[d];return void 0!==u?a.data[u]:null},getNodeChildren:function(r){var t=[];return this.each(function(){var a=this,i=a.p;if(a.grid&&i.treeGrid)switch(i.treeGridModel){case"nested":var d=i.treeReader.left_field,l=i.treeReader.right_field,n=i.treeReader.level_field,o=parseInt(r[d],10),s=parseInt(r[l],10),c=parseInt(r[n],10);e(i.data).each(function(){parseInt(this[n],10)===c+1&&parseInt(this[d],10)>o&&parseInt(this[l],10)<s&&t.push(this)});break;case"adjacency":var f=i.treeReader.parent_id_field,p=i.localReader.id;e(i.data).each(function(){String(this[f])===String(r[p])&&t.push(this)})}}),t},getFullTreeNode:function(r){var t=[];return this.each(function(){var a,i=this,d=i.p;if(i.grid&&d.treeGrid)switch(d.treeGridModel){case"nested":var l=d.treeReader.left_field,n=d.treeReader.right_field,o=d.treeReader.level_field,s=parseInt(r[l],10),c=parseInt(r[n],10),f=parseInt(r[o],10);e(d.data).each(function(){parseInt(this[o],10)>=f&&parseInt(this[l],10)>=s&&parseInt(this[l],10)<=c&&t.push(this)});break;case"adjacency":if(r){t.push(r);var p=d.treeReader.parent_id_field,u=d.localReader.id;e(d.data).each(function(){var e;for(a=t.length,e=0;e<a;e++)if(String(t[e][u])===String(this[p])){t.push(this);break}})}}}),t},getNodeAncestors:function(r){var t=[];return this.each(function(){var a=this,i=e(a),l=d.getNodeParent;if(a.grid&&a.p.treeGrid)for(var n=l.call(i,r);n;)t.push(n),n=l.call(i,n)}),t},isVisibleNode:function(r){var t=!0;return this.each(function(){var a=this,i=a.p;if(a.grid&&i.treeGrid){var l=d.getNodeAncestors.call(e(a),r),n=i.treeReader.expanded_field;e(l).each(function(){if(!(t=t&&this[n]))return!1})}}),t},isNodeLoaded:function(r){var t;return this.each(function(){var a=this,i=a.p;if(a.grid&&i.treeGrid){var l=i.treeReader.leaf_field,n=i.treeReader.loaded;t=void 0!==r&&(void 0!==r[n]?r[n]:!!(r[l]||d.getNodeChildren.call(e(a),r).length>0))}}),t},expandNode:function(r){return this.each(function(){var a=this,n=a.p;if(a.grid&&n.treeGrid){var o=n.treeReader.expanded_field,s=n.treeReader.parent_id_field,c=n.treeReader.loaded,f=n.treeReader.level_field,p=n.treeReader.left_field,u=n.treeReader.right_field;if(!r[o]){var h=t(r,n.localReader.id);if(!l.call(a,"beforeExpandNode",{rowid:h,item:r}))return;var v=e("#"+n.idPrefix+i(h),a.grid.bDiv)[0],g=n._index[h];"local"===n.treedatatype||d.isNodeLoaded.call(e(a),n.data[g])?(r[o]=!0,e("div.treeclick",v).removeClass(n.treeIcons.plus+" tree-plus").addClass(n.treeIcons.commonIconClass).addClass(n.treeIcons.minus+" tree-minus")):a.grid.hDiv.loading||(r[o]=!0,e("div.treeclick",v).removeClass(n.treeIcons.plus+" tree-plus").addClass(n.treeIcons.commonIconClass).addClass(n.treeIcons.minus+" tree-minus"),n.treeANode=v.rowIndex,n.datatype=n.treedatatype,d.setGridParam.call(e(a),{postData:"nested"===n.treeGridModel?{nodeid:h,n_level:r[f],n_left:r[p],n_right:r[u]}:{nodeid:h,n_level:r[f],parentid:r[s]}}),e(a).trigger("reloadGrid"),r[c]=!0,d.setGridParam.call(e(a),{postData:"nested"===n.treeGridModel?{nodeid:"",n_level:"",n_left:"",n_right:""}:{nodeid:"",n_level:"",parentid:""}})),l.call(a,"afterExpandNode",{rowid:h,item:r})}}})},collapseNode:function(r){return this.each(function(){var a=this,d=a.p;if(a.grid&&d.treeGrid){var n=d.treeReader.expanded_field;if(r[n]){var o=t(r,d.localReader.id);if(!l.call(a,"beforeCollapseNode",{rowid:o,item:r}))return;r[n]=!1,e("#"+d.idPrefix+i(o),a.grid.bDiv).find("div.treeclick").removeClass(d.treeIcons.minus+" tree-minus").addClass(d.treeIcons.commonIconClass).addClass(d.treeIcons.plus+" tree-plus"),(!0===d.unloadNodeOnCollapse||e.isFunction(d.unloadNodeOnCollapse)&&d.unloadNodeOnCollapse.call(a,r))&&(r[d.treeReader.loaded]=!1,e(a).jqGrid("delTreeNode",o,!0)),l.call(a,"afterCollapseNode",{rowid:o,item:r})}}})},SortTree:function(a,l,n,o){return this.each(function(){var s=this,c=s.p,f=e(s);if(s.grid&&c.treeGrid){var p,u,h,v=[],g=d.getRootNodes.call(f),R=r.from.call(s,g);R.orderBy(a,l,n,o);var _=R.select();for(p=0,u=_.length;p<u;p++)h=_[p],v.push(h),d.collectChildrenSortTree.call(f,v,h,a,l,n,o);e.each(v,function(r){var a=t(this,c.localReader.id);e(s.rows[r]).after(f.find(">tbody>tr#"+i(a)))})}})},collectChildrenSortTree:function(t,a,i,l,n,o){return this.each(function(){var s=this,c=e(s);if(s.grid&&s.p.treeGrid){var f,p,u,h=d.getNodeChildren.call(c,a),v=r.from.call(s,h);v.orderBy(i,l,n,o);var g=v.select();for(f=0,p=g.length;f<p;f++)u=g[f],t.push(u),d.collectChildrenSortTree.call(c,t,u,i,l,n,o)}})},setTreeRow:function(r,t){var a=!1;return this.each(function(){var i=this;i.grid&&i.p.treeGrid&&(a=d.setRowData.call(e(i),r,t))}),a},delTreeNode:function(t,a){return this.each(function(){var i,l,n,o,s,c=this,f=c.p,p=f.localReader.id,u=e(c),h=f.treeReader.left_field,v=f.treeReader.right_field;if(c.grid&&f.treeGrid){var g=f._index[t];if(void 0!==g){l=(i=parseInt(f.data[g][v],10))-parseInt(f.data[g][h],10)+1;var R=d.getFullTreeNode.call(u,f.data[g]);if(R.length>0)for(s=0;s<R.length;s++)a&&t===R[s][p]||d.delRowData.call(u,R[s][p]);if("nested"===f.treeGridModel){if((n=r.from.call(c,f.data).greater(h,i,{stype:"integer"}).select()).length)for(o in n)n.hasOwnProperty(o)&&(n[o][h]=parseInt(n[o][h],10)-l);if((n=r.from.call(c,f.data).greater(v,i,{stype:"integer"}).select()).length)for(o in n)n.hasOwnProperty(o)&&(n[o][v]=parseInt(n[o][v],10)-l)}}}})},addChildNode:function(t,a,i,l){return this.each(function(){if(i){var n,o,s,c,f,p,u,h=this,v=h.p,g=e(h),R=d.getInd,_=a,I=v.treeReader.expanded_field,w=v.treeReader.leaf_field,m=v.treeReader.level_field,y=v.treeReader.parent_id_field,G=v.treeReader.left_field,x=v.treeReader.right_field,C=v.treeReader.loaded;void 0===l&&(l=!1),null==t&&(t=r.randId());var N=R.call(g,a);if(p=!1,void 0===a||null===a||""===a)a=null,_=null,n="last",c=v.tree_root_level;else{n="after",o=v._index[a],s=v.data[o],a=s[v.localReader.id],f=R.call(g,a),c=parseInt(s[m],10)+1;var b=d.getFullTreeNode.call(g,s);if(b.length){var P,j,M;for(P=0;P<b.length;P++)M=b[P][v.localReader.id],(j=R.call(g,M))>f&&(f=j,_=M)}s[w]&&(p=!0,s[I]=!0,e(h.rows[N]).find("span.cell-wrapperleaf").removeClass("cell-wrapperleaf").addClass("cell-wrapper").end().find("div.tree-leaf").removeClass(v.treeIcons.leaf+" tree-leaf").addClass(v.treeIcons.commonIconClass).addClass(v.treeIcons.minus+" tree-minus"),v.data[o][w]=!1,s[C]=!0)}if(void 0===i[I]&&(i[I]=!1),void 0===i[C]&&(i[C]=!1),i[m]=c,void 0===i[w]&&(i[w]=!0),"adjacency"===v.treeGridModel&&(i[y]=a),"nested"===v.treeGridModel){var T,k,S;if(null!==a){if(u=parseInt(s[x],10),T=r.from.call(h,v.data),T=T.greaterOrEquals(x,u,{stype:"integer"}),(k=T.select()).length)for(S in k)k.hasOwnProperty(S)&&(k[S][G]=k[S][G]>u?parseInt(k[S][G],10)+2:k[S][G],k[S][x]=k[S][x]>=u?parseInt(k[S][x],10)+2:k[S][x]);i[G]=u,i[x]=u+1}else{if(u=parseInt(d.getCol.call(g,x,!1,"max"),10),(k=r.from.call(h,v.data).greater(G,u,{stype:"integer"}).select()).length)for(S in k)k.hasOwnProperty(S)&&(k[S][G]=parseInt(k[S][G],10)+2);if((k=r.from.call(h,v.data).greater(x,u,{stype:"integer"}).select()).length)for(S in k)k.hasOwnProperty(S)&&(k[S][x]=parseInt(k[S][x],10)+2);i[G]=u+1,i[x]=u+2}}(null===a||d.isNodeLoaded.call(g,s)||p)&&d.addRowData.call(g,t,i,n,_),s&&!s[I]&&l&&e(h.rows[N]).find("div.treeclick").click()}})}})});
//# sourceMappingURL=grid.treegrid.js.map